/*!
 * chartjs-plugin-piechart-outlabels
 * http://chartjs.org/
 * Version: 0.1.3
 *
 * Copyright 2020 Neckster
 * Released under the MIT license
 * https://github.com/Neckster/chartjs-plugin-piechart-outlabels/blob/master/LICENSE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Chart)}(this,(function(t){"use strict";var e=(t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t).helpers,i=e.merge(e,{toFontString:function(t){return!t||e.isNullOrUndef(t.size)||e.isNullOrUndef(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family},textSize:function(t,e,i){var s,n=[].concat(e),h=n.length,r=t.font,l=0;for(t.font=i.string,s=0;s<h;++s)l=Math.max(t.measureText(n[s]).width,l);return t.font=r,{height:h*i.lineHeight,width:l}},parseFont:function(i,s){var n=t.defaults.global,h=e.valueOrDefault(i.size,n.defaultFontSize);i.resizable&&(h=this.adaptTextSizeToHeight(s,i.minSize,i.maxSize));var r={family:e.valueOrDefault(i.family,n.defaultFontFamily),lineHeight:e.options.toLineHeight(i.lineHeight,h),size:h,style:e.valueOrDefault(i.style,n.defaultFontStyle),weight:e.valueOrDefault(i.weight,null),string:""};return r.string=e.toFontString(r),r},adaptTextSizeToHeight:function(t,e,i){var s=t/100*2.5;return e&&s<e?e:i&&s>i?i:s}}),s={LABEL_KEY:"$outlabels",backgroundColor:function(t){return t.dataset.backgroundColor},borderColor:function(t){return t.dataset.backgroundColor},lineColor:function(t){return t.dataset.backgroundColor},borderRadius:0,borderWidth:0,lineWidth:2,color:"white",display:!0,font:{family:void 0,size:void 0,style:void 0,weight:null,maxSize:null,minSize:null,resizable:!0},lineHeight:1.2,padding:{top:4,right:4,bottom:4,left:4},textAlign:"center",stretch:40,text:"%l %p",zoomOutPercentage:50,percentPrecision:1,valuePrecision:3},n=function(){Math.trunc||(Math.trunc=function(t){return(t=+t)-t%1||(isFinite(t)&&0!==t?t<0?-0:0:t)}),t.defaults.outlabeledDoughnut=t.defaults.doughnut,t.defaults.outlabeledPie=t.defaults.pie;var e=function(e){t.controllers.doughnut.prototype.update.call(this);var i=this,n=i.getMeta(),h=i.chart.options.zoomOutPercentage||s.zoomOutPercentage;i.outerRadius*=1-h/100,i.innerRadius*=1-h/100,t.helpers.each(n.data,(function(t,s){i.updateElement(t,s,e)}))},i=t.controllers.doughnut.extend({update:e}),n=t.controllers.pie.extend({update:e});t.controllers.outlabeledPie=n,t.controllers.outlabeledDoughnut=i},h=function(t,e){var i=(t.startAngle+t.endAngle)/2,s=Math.cos(i),n=Math.sin(i),h=t.outerRadius,r=h+e;return{x:t.x+s*r,y:t.y+n*r,d:r,arc:t,anchor:{x:t.x+s*h,y:t.y+n*h},copy:{x:t.x+s*r,y:t.y+n*r}}},r=function(t,e){var i=t.arc,s=t.d,n=(i.startAngle+i.endAngle)/2,h=Math.cos(n),r=Math.sin(n);return s+=e,{x:i.x+h*s,y:i.y+r*s,d:s,arc:i,anchor:t.anchor,copy:{x:i.x+h*s,y:i.y+r*s}}},l=t.helpers,o=s.LABEL_KEY,a=function(e,i,n,a,c){var d=t.helpers.options.resolve;if(!d([a.display,!0],c,i))throw new Error("Label display property is set to false.");var f=c.dataset.data[i],u=c.labels[i],x=d([a.text,s.text],c,i);((x=x.replace(/%l/gi,u)).match(/%v\.?(\d*)/gi)||[]).map((function(t){var e=t.replace(/%v\./gi,"");return e.length?+e:a.valuePrecision||s.valuePrecision})).forEach((function(t){x=x.replace(/%v\.?(\d*)/i,f.toFixed(t))})),(x.match(/%p\.?(\d*)/gi)||[]).map((function(t){var e=t.replace(/%p\./gi,"");return e.length?+e:a.percentPrecision||s.percentPrecision})).forEach((function(t){x=x.replace(/%p\.?(\d*)/i,(100*c.percent).toFixed(t)+"%")}));var g=x.match(/[^\r\n]+/g);if(!g||!g.length)throw new Error("No text to show.");for(var y=0;y<g.length;++y)g[y]=g[y].trim();this.init=function(t,h){this.encodedText=a.text,this.text=t,this.lines=h,this.label=u,this.value=f,this.ctx=n,this.style={backgroundColor:d([a.backgroundColor,s.backgroundColor,"black"],c,i),borderColor:d([a.borderColor,s.borderColor,"black"],c,i),borderRadius:d([a.borderRadius,0],c,i),borderWidth:d([a.borderWidth,0],c,i),lineWidth:d([a.lineWidth,2],c,i),lineColor:d([a.lineColor,s.lineColor,"black"],c,i),color:d([a.color,"white"],c,i),font:l.parseFont(d([a.font,{resizable:!0}]),n.canvas.style.height.slice(0,-2)),padding:l.options.toPadding(d([a.padding,0],c,i)),textAlign:d([a.textAlign,"left"],c,i)},this.stretch=d([a.stretch,40],c,i),this.size=l.textSize(n,this.lines,this.style.font),this.offsetStep=this.size.width/20,this.offset={x:0,y:0},this.predictedOffset=this.offset;var r=-(e._model.startAngle+e._model.endAngle)/2/Math.PI,o=Math.abs(r-Math.trunc(r));o>.45&&o<.55?this.predictedOffset.x=0:r<=.45&&r>=-.45?this.predictedOffset.x=this.size.width/2:r>=-1.45&&r<=-.55&&(this.predictedOffset.x=-this.size.width/2)},this.init(x,g),this.computeLabelRect=function(){var t=this.textRect.width+2*this.style.borderWidth,e=this.textRect.height+2*this.style.borderWidth;return{x:this.textRect.x-this.style.padding.left-this.style.borderWidth,y:this.textRect.y-this.style.padding.top-this.style.borderWidth,width:t+=this.style.padding.width,height:e+=this.style.padding.height}},this.computeTextRect=function(){return{x:this.center.x-this.size.width/2,y:this.center.y-this.size.height/2,width:this.size.width,height:this.size.height}},this.getPoints=function(){return[{x:this.labelRect.x,y:this.labelRect.y},{x:this.labelRect.x+this.labelRect.width,y:this.labelRect.y},{x:this.labelRect.x+this.labelRect.width,y:this.labelRect.y+this.labelRect.height},{x:this.labelRect.x,y:this.labelRect.y+this.labelRect.height}]},this.containsPoint=function(t,e){return e||(e=5),this.labelRect.x-e<=t.x&&t.x<=this.labelRect.x+this.labelRect.width+e&&this.labelRect.y-e<=t.y&&t.y<=this.labelRect.y+this.labelRect.height+e},this.drawText=function(){var t,e,i,s=this.style.textAlign,n=this.style.font.lineHeight,h=this.style.color,r=this.lines.length;if(r&&h)for(t=this.textRect.x,e=this.textRect.y+n/2,"center"===s?t+=this.textRect.width/2:"end"!==s&&"right"!==s||(t+=this.textRect.width),this.ctx.font=this.style.font.string,this.ctx.fillStyle=h,this.ctx.textAlign=s,this.ctx.textBaseline="middle",i=0;i<r;++i)this.ctx.fillText(this.lines[i],Math.round(t),Math.round(e),Math.round(this.textRect.width)),e+=n},this.drawLabel=function(){n.beginPath(),l.canvas.roundedRect(this.ctx,Math.round(this.labelRect.x),Math.round(this.labelRect.y),Math.round(this.labelRect.width),Math.round(this.labelRect.height),this.style.borderRadius),this.ctx.closePath(),this.style.backgroundColor&&(this.ctx.fillStyle=this.style.backgroundColor||"black",this.ctx.fill()),this.style.borderColor&&this.style.borderWidth&&(this.ctx.strokeStyle=this.style.borderColor,this.ctx.lineWidth=this.style.borderWidth,this.ctx.lineJoin="miter",this.ctx.stroke())},this.drawLine=function(){this.ctx.save(),this.ctx.strokeStyle=this.style.lineColor,this.ctx.lineWidth=this.style.lineWidth,this.ctx.lineJoin="miter",this.ctx.beginPath(),this.ctx.moveTo(this.center.anchor.x,this.center.anchor.y),this.ctx.lineTo(this.center.copy.x,this.center.copy.y),this.ctx.stroke(),this.ctx.restore()},this.draw=function(){this.drawLabel(),this.drawText()},this.update=function(t,e,i){this.center=h(t,this.stretch),this.moveLabelToOffset(),this.center.x+=this.offset.x,this.center.y+=this.offset.y;for(var s=!1;!s;){this.textRect=this.computeTextRect(),this.labelRect=this.computeLabelRect();var n=this.getPoints();s=!0;for(var l=0;l<i;++l){var a=e[l][o];if(a)for(var c=a.getPoints(),d=0;d<n.length;++d){if(a.containsPoint(n[d])){s=!1;break}if(this.containsPoint(c[d])){s=!1;break}}}s||(this.center=r(this.center,1),this.center.x+=this.offset.x,this.center.y+=this.offset.y)}},this.moveLabelToOffset=function(){this.predictedOffset.x<=0&&this.offset.x>this.predictedOffset.x?(this.offset.x-=this.offsetStep,this.offset.x<=this.predictedOffset.x&&(this.offset.x=this.predictedOffset.x)):this.predictedOffset.x>=0&&this.offset.x<this.predictedOffset.x&&(this.offset.x+=this.offsetStep,this.offset.x>=this.predictedOffset.x&&(this.offset.x=this.predictedOffset.x))}};n(),t.defaults.global.plugins.outlabels=s;var c=s.LABEL_KEY;t.plugins.register({id:"outlabels",resize:function(t,e,i){t.sizeChanged=!0},afterDatasetUpdate:function(t,e,s){var n,h,r,l,o,d,f=t.config.data.labels,u=t.data.datasets[e.index],x=function(t,e){var s=t.outlabels;return!1===s?null:(!0===s&&(s={}),i.merge({},[e,s]))}(u,s),g=x&&x.display,y=e.meta.data||[],b=t.ctx;for(b.save(),d=0;d<y.length;++d){if(h=(n=y[d])[c],r=u.data[d]/e.meta.total,l=null,g&&n&&!n.hidden)try{o={chart:t,dataIndex:d,dataset:u,labels:f,datasetIndex:e.index,percent:r},l=new a(n,d,b,x,o)}catch(t){l=null}h&&l&&!t.sizeChanged&&h.label===l.label&&h.encodedText===l.encodedText&&(l.offset=h.offset),n[c]=l}b.restore(),t.sizeChanged=!1},afterDatasetDraw:function(t,e){for(var i,s,n=e.meta.data||[],h=t.ctx,r=0;r<2*n.length;++r)(s=(i=n[r<n.length?r:r-n.length])[c])&&(r<n.length?(s.update(i._view,n,r),s.drawLine(h)):s.draw(h))}})}));
